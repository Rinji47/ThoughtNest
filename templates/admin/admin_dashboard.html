{% extends "base.html" %}
{% load static %}

{% block title %}Admin Dashboard - ThoughtNest{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/admin_dashboard.css' %}">
{% endblock %}

{% block content %}
<div class="container">
    <div class="admin-header">
        <h1>Admin Dashboard</h1>
        <a href="{% url 'post_create' %}" class="btn-primary">Create New Post</a>
    </div>

    <!-- Admin Stats -->
    <div class="admin-stats">
        <div class="stat-card">
            <span class="stat-icon"><i class="fa-solid fa-pen-nib"></i></span>
            <div class="stat-info">
                <h3>Total Posts</h3>
                <p class="stat-value">{{ total_posts }}</p>
            </div>
        </div>
        <div class="stat-card">
            <span class="stat-icon"><i class="fa-solid fa-heart"></i></span>
            <div class="stat-info">
                <h3>Total Likes</h3>
                <p class="stat-value">{{ total_likes }}</p>
            </div>
        </div>
        <div class="stat-card">
            <span class="stat-icon"><i class="fa-solid fa-comment"></i></span>
            <div class="stat-info">
                <h3>Total Comments</h3>
                <p class="stat-value">{{ total_comments }}</p>
            </div>
        </div>
        <div class="stat-card">
            <span class="stat-icon"><i class="fa-solid fa-envelope"></i></span>
            <div class="stat-info">
                <h3>Subscribers</h3>
                <p class="stat-value">384</p>
            </div>
        </div>
    </div>

    <!-- Admin Tabs -->
    <div class="admin-tabs">
        <button class="admin-tab-btn active" data-tab="posts-management">Posts</button>
        <button class="admin-tab-btn" data-tab="categories-management">Categories</button>
        <button class="admin-tab-btn" data-tab="comments-management">Comments</button>
        <button class="admin-tab-btn" data-tab="subscribers">Subscribers</button>
        <button class="admin-tab-btn" data-tab="site-settings">Settings</button>
    </div>

    <!-- Posts Management Tab -->
    <div class="admin-tab-content active" id="posts-management">
        <h2>Manage Posts</h2>
        <div class="table-controls">
            <input type="text" id="postsSearch" class="search-box" placeholder="Search posts...">
            <button class="btn-secondary">Export</button>
        </div>
        
        <table class="admin-table">
            <thead>
                <tr>
                    <th>Title</th>
                    <th>Author</th>
                    <th>Category</th>
                    <th>Status</th>
                    <th>Likes</th>
                    <th>Comments</th>
                    <th>Date</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for post in posts %}
                <tr>
                    <td><a href="{% url 'post_detail' post.pk %}">{{ post.title }}</a></td>
                    <td>{{ post.author.get_full_name|default:post.author.username }}</td>
                    <td>{% if post.category %}{{ post.category.name }}{% else %}Uncategorized{% endif %}</td>
                    <td><span class="status-badge published">{{ post.get_status_display }}</span></td>
                    <td>{{ post.likes.count }}</td>
                    <td>{{ post.comments.count }}</td>
                    <td>{{ post.created_at|date:"M d, Y" }}</td>
                    <td class="action-buttons">
                        <a href="{% url 'post_edit' post.pk %}" class="btn-sm">Edit</a>
                        <button class="btn-sm btn-delete">Delete</button>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="8">No posts yet.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Categories Management Tab -->
    <div class="admin-tab-content" id="categories-management">
        <h2>Manage Categories</h2>
        
        <!-- Create Category Form -->
        <div class="create-category-form-container">
            <h3>Create New Category</h3>
            <form method="post" action="{% url 'admin_create_category' %}" class="create-category-form">
                {% csrf_token %}
                <div class="form-group">
                    <label for="categoryName">Category Name</label>
                    <input type="text" id="categoryName" name="name" placeholder="Enter category name" required>
                </div>
                <button type="submit" class="btn-primary">Create Category</button>
            </form>
        </div>

        <!-- Categories List -->
        <div class="table-controls">
            <input type="text" id="categoriesSearch" class="search-box" placeholder="Search categories...">
        </div>

        <table class="admin-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Slug</th>
                    <th>Posts Count</th>
                    <th>Created</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for category in categories %}
                <tr>
                    <td>{{ category.name }}</td>
                    <td><code>{{ category.slug }}</code></td>
                    <td><span class="badge">{{ category.post_count }}</span></td>
                    <td>{{ category.created_at|date:"M d, Y" }}</td>
                    <td class="action-buttons">
                        <form method="post" action="{% url 'admin_delete_category' category.pk %}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this category?');">
                            {% csrf_token %}
                            <button type="submit" class="btn-sm btn-delete">Delete</button>
                        </form>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" style="text-align: center;">No categories yet. Create one above!</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Comments Management Tab -->
    <div class="admin-tab-content" id="comments-management">
        <h2>Manage Comments</h2>
        <div class="table-controls">
            <select id="commentFilter" class="filter-select">
                <option value="">All Comments</option>
                <option value="pending">Pending Review</option>
                <option value="approved">Approved</option>
                <option value="spam">Spam</option>
            </select>
            <input type="text" id="commentsSearch" class="search-box" placeholder="Search comments...">
        </div>

        <div class="comments-management-list">
            <div class="comment-item">
                <div class="comment-content">
                    <strong>Alex Chen</strong>
                    <span class="comment-date">1 day ago</span>
                    <p>Great beginner-friendly guide! I appreciate how you explained each concept clearly.</p>
                    <small><strong>On:</strong> Getting Started with Web Development</small>
                </div>
                <div class="comment-actions">
                    <button class="btn-approve">Approve</button>
                    <button class="btn-delete">Delete</button>
                </div>
            </div>

            <div class="comment-item">
                <div class="comment-content">
                    <strong>Maria Garcia</strong>
                    <span class="comment-date">2 days ago</span>
                    <p>Looking forward to the JavaScript deep-dive article. This was really helpful!</p>
                    <small><strong>On:</strong> Modern UI Design Principles</small>
                </div>
                <div class="comment-actions">
                    <button class="btn-approve">Approve</button>
                    <button class="btn-delete">Delete</button>
                </div>
            </div>

            <div class="comment-item">
                <div class="comment-content">
                    <strong>Spam Sender</strong>
                    <span class="comment-date">3 days ago</span>
                    <p>Click here to buy cheap products!!!</p>
                    <small><strong>On:</strong> Work-Life Balance Tips</small>
                </div>
                <div class="comment-actions">
                    <button class="btn-spam">Mark as Spam</button>
                    <button class="btn-delete">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Subscribers Tab -->
    <div class="admin-tab-content" id="subscribers">
        <h2>Email Subscribers</h2>
        <div class="table-controls">
            <input type="text" id="subscribersSearch" class="search-box" placeholder="Search subscribers...">
            <button class="btn-secondary">Export List</button>
        </div>

        <table class="admin-table">
            <thead>
                <tr>
                    <th>Email</th>
                    <th>Subscription Date</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>user1@example.com</td>
                    <td>Jan 15, 2025</td>
                    <td><span class="status-badge active">Active</span></td>
                    <td><button class="btn-sm btn-delete">Remove</button></td>
                </tr>
                <tr>
                    <td>user2@example.com</td>
                    <td>Jan 12, 2025</td>
                    <td><span class="status-badge active">Active</span></td>
                    <td><button class="btn-sm btn-delete">Remove</button></td>
                </tr>
                <tr>
                    <td>user3@example.com</td>
                    <td>Jan 10, 2025</td>
                    <td><span class="status-badge active">Active</span></td>
                    <td><button class="btn-sm btn-delete">Remove</button></td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Settings Tab -->
    <div class="admin-tab-content" id="site-settings">
        <h2>Site Settings</h2>
        <form class="settings-form" id="adminSettingsForm">
            <div class="form-group">
                <label for="siteName">Site Name</label>
                <input type="text" id="siteName" value="MyBlog" required>
            </div>

            <div class="form-group">
                <label for="siteDescription">Site Description</label>
                <textarea id="siteDescription" rows="3">Discover amazing stories, insights, and knowledge</textarea>
            </div>

            <div class="form-group">
                <label for="postsPerPage">Posts Per Page</label>
                <input type="number" id="postsPerPage" value="9" min="1" max="50">
            </div>

            <div class="form-group">
                <label class="checkbox">
                    <input type="checkbox" checked>
                    <span>Allow comments on new posts</span>
                </label>
            </div>

            <div class="form-group">
                <label class="checkbox">
                    <input type="checkbox" checked>
                    <span>Require comment approval</span>
                </label>
            </div>

            <button type="submit" class="btn-primary">Save Settings</button>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/admin_dashboard.js' %}"></script>
{% endblock %}
