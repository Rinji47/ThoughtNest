{% extends "base_dashboard.html" %}
{% load static %}

{% block title %}Profile Overview - ThoughtNest{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/user_profile.css' %}">
{% endblock %}

{% block content %}

<div class="profile-wrapper">
    {% include 'users/profile_sidebar.html' %}

    <main class="profile-content">
        
    {% if messages %}
        <div class="messages-container">
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}
        <section class="section-container">
            <div class="overview-grid">
                <div class="overview-card">
                    <div class="overview-card-number">{{ user_post_count }}</div>
                    <div class="overview-card-label">Posts Published</div>
                </div>
                <div class="overview-card">
                    <div class="overview-card-number">{{ user_like_count }}</div>
                    <div class="overview-card-label">Likes Received</div>
                </div>
                <div class="overview-card">
                    <div class="overview-card-number">{{ user_comment_count }}</div>
                    <div class="overview-card-label">Comments</div>
                </div>
            </div>

            <!-- User Bio and Info -->
            <div class="profile-bio-info" style="margin: 2.5rem 0 1.5rem 0; padding: 1.5rem 2rem; background: #fffaf5; border-radius: 18px; box-shadow: 0 2px 8px rgba(107,75,62,0.06);">
                <h2 style="font-size: 1.3rem; color: var(--primary-color); margin-bottom: 0.7rem;">About Me</h2>
                <p style="margin-bottom: 0.5rem; color: #6c6156;">{{ request.user.profile.bio|default:'No bio yet.' }}</p>
                <div style="display: flex; gap: 2.5rem; flex-wrap: wrap; color: #8b6f47; font-size: 1.05rem;">
                    {% if request.user.profile.location %}<span><i class="fa-solid fa-location-dot"></i> {{ request.user.profile.location }}</span>{% endif %}
                    {% if request.user.profile.website %}<span><i class="fa-solid fa-link"></i> <a href="{{ request.user.profile.website }}" target="_blank" style="color: #8b6f47; text-decoration: underline;">Website</a></span>{% endif %}
                </div>
                <a href="{% url 'profile_settings' %}" class="btn-edit" style="margin-top: 1.2rem; display: inline-block;"><i class="fa-solid fa-pen-to-square"></i> Edit Profile</a>
            </div>

            <!-- Recent Comments -->
            <div style="margin-bottom: 2.5rem;">
                <h2 style="font-size: 1.15rem; color: var(--primary-color); margin-bottom: 0.7rem;">Recent Comments</h2>
                {% if my_comments %}
                <ul style="list-style: none; padding: 0; margin: 0;">
                    {% for comment in my_comments %}
                    <li style="margin-bottom: 0.7rem; background: #f7f1ea; border-radius: 10px; padding: 0.7rem 1.1rem;">
                        <a href="{% url 'post_detail' comment.post.pk %}" style="font-weight: 600; color: var(--primary-color); text-decoration: underline;">{{ comment.post.title|truncatechars:30 }}</a>
                        <span style="color: #a0845b; font-size: 0.95rem; margin-left: 0.7rem;">{{ comment.created_at|date:"M d, Y H:i" }}</span>
                        <div style="color: #2b251f; margin-top: 0.2rem;">{{ comment.content|truncatechars:60 }}</div>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p style="color: #b7a48a;">No recent comments.</p>
                {% endif %}
            </div>

            <!-- Recent Liked Posts -->
            <div>
                <h2 style="font-size: 1.15rem; color: var(--primary-color); margin-bottom: 0.7rem;">Recent Liked Posts</h2>
                {% if liked_posts %}
                <ul style="list-style: none; padding: 0; margin: 0; display: flex; gap: 1.2rem; flex-wrap: wrap;">
                    {% for post in liked_posts %}
                    <li style="background: #f7f1ea; border-radius: 10px; padding: 0.7rem 1.1rem; min-width: 180px;">
                        <a href="{% url 'post_detail' post.pk %}" style="font-weight: 600; color: var(--primary-color); text-decoration: underline;">{{ post.title|truncatechars:30 }}</a>
                        <div style="color: #a0845b; font-size: 0.95rem; margin-top: 0.2rem;"><i class="fa-solid fa-heart"></i> {{ post.likes.count }} | <i class="fa-solid fa-comment"></i> {{ post.comments.count }}</div>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p style="color: #b7a48a;">No recent liked posts.</p>
                {% endif %}
            </div>
        </section>
    </main>
</div>
{% endblock %}
